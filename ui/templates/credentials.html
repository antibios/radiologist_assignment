{{ define "content" }}
<div class="container">
    <div class="row">
        <div class="col max">
            <h4>Credentials Management</h4>
        </div>
        <div class="col min">
            <button class="primary" onclick="ui('#add-cred-modal')">
                <i>add</i>
                <span>Add Credential</span>
            </button>
        </div>
    </div>

    <table class="stripes">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Description</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {{ range .Credentials }}
            <tr id="cred-row-{{.ID}}">
                <td>{{ .ID }}</td>
                <td class="cred-name">{{ .Name }}</td>
                <td>{{ .Description }}</td>
                <td>
                    <button class="circle transparent small" onclick="openEditCredModal('{{.ID}}', '{{.Name}}', '{{.Description}}')">
                        <i>edit</i>
                    </button>
                    <form action="/api/credentials/delete" method="POST" style="display:inline;">
                        <input type="hidden" name="csrf_token" value="{{ $.CSRFToken }}">
                        <input type="hidden" name="id" value="{{.ID}}">
                        <button class="circle transparent small error-text" type="submit">
                            <i>delete</i>
                        </button>
                    </form>
                </td>
            </tr>
            {{ end }}
        </tbody>
    </table>
</div>

<!-- Add Credential Modal -->
<dialog id="add-cred-modal">
    <h5>Add New Credential</h5>
    <form action="/api/credentials" method="POST">
        <input type="hidden" name="csrf_token" value="{{ $.CSRFToken }}">
        <div class="field label border">
            <input type="text" name="id" required>
            <label>ID (e.g. MRI)</label>
        </div>
        <div class="field label border">
            <input type="text" name="name" required>
            <label>Name</label>
        </div>
        <div class="field label border">
            <input type="text" name="description">
            <label>Description</label>
        </div>
        <nav class="right-align">
            <button type="button" class="transparent link" onclick="ui('#add-cred-modal')">Cancel</button>
            <button type="submit" class="primary">Save Credential</button>
        </nav>
    </form>
</dialog>

<!-- Edit Credential Modal -->
<dialog id="edit-cred-modal">
    <h5>Edit Credential</h5>
    <form action="/api/credentials/edit" method="POST">
        <input type="hidden" name="csrf_token" value="{{ $.CSRFToken }}">
        <input type="hidden" name="id" id="edit-cred-id">
        <div class="field label border">
            <input type="text" name="name" id="edit-cred-name" required>
            <label>Name</label>
        </div>
        <div class="field label border">
            <input type="text" name="description" id="edit-cred-desc">
            <label>Description</label>
        </div>
        <nav class="right-align">
            <button type="button" class="transparent link" onclick="ui('#edit-cred-modal')">Cancel</button>
            <button type="submit" class="primary">Update Credential</button>
        </nav>
    </form>
</dialog>

<script>
    function openEditCredModal(id, name, desc) {
        document.getElementById('edit-cred-id').value = id;
        document.getElementById('edit-cred-name').value = name;
        document.getElementById('edit-cred-desc').value = desc;
        document.getElementById('edit-cred-modal').setAttribute('open', 'true');
    }
</script>
{{ end }}
