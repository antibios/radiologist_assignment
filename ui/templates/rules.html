{{ define "content" }}
<div class="container">
    <div class="row">
        <div class="col max">
            <h4>Assignment Rules</h4>
        </div>
        <div class="col min">
            <button class="primary" onclick="ui('#add-rule-modal')">
                <i>add</i>
                <span>Add Rule</span>
            </button>
        </div>
    </div>

    <table class="stripes">
        <thead>
            <tr>
                <th>Priority</th>
                <th>Name</th>
                <th>Action Type</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {{ range .Rules }}
            <tr id="rule-row-{{.ID}}">
                <td>{{ .PriorityOrder }}</td>
                <td class="rule-name">{{ .Name }}</td>
                <td>{{ .ActionType }}</td>
                <td>
                    {{ if .Enabled }}
                    <span class="badge green">Enabled</span>
                    {{ else }}
                    <span class="badge red">Disabled</span>
                    {{ end }}
                </td>
                <td>
                    <button class="circle transparent small" onclick="openEditModal({{.ID}}, '{{.Name}}', '{{.ActionType}}')">
                        <i>edit</i>
                    </button>
                    <form action="/api/rules/delete" method="POST" style="display:inline;">
                        <input type="hidden" name="csrf_token" value="{{ $.CSRFToken }}">
                        <input type="hidden" name="id" value="{{.ID}}">
                        <button class="circle transparent small error-text" type="submit">
                            <i>delete</i>
                        </button>
                    </form>
                </td>
            </tr>
            {{ end }}
        </tbody>
    </table>
</div>

<!-- Add Modal -->
<dialog id="add-rule-modal">
    <h5>Add New Rule</h5>
    <form action="/api/rules" method="POST">
        <input type="hidden" name="csrf_token" value="{{ $.CSRFToken }}">
        <div class="field label border">
            <input type="text" name="name" required>
            <label>Rule Name</label>
        </div>
        <div class="field label border">
            <select name="action">
                <option value="FILTER_COMPETENCY">Filter Competency</option>
                <option value="ESCALATE">Escalate</option>
                <option value="ASSIGN_TO_SHIFT">Assign to Shift</option>
                <option value="ASSIGN_TO_RADIOLOGIST">Assign to Radiologist</option>
            </select>
            <label>Action Type</label>
        </div>
        <nav class="right-align">
            <button type="button" class="transparent link" onclick="ui('#add-rule-modal')">Cancel</button>
            <button type="submit" class="primary">Save Rule</button>
        </nav>
    </form>
</dialog>

<!-- Edit Modal -->
<dialog id="edit-rule-modal">
    <h5>Edit Rule</h5>
    <form action="/api/rules/edit" method="POST">
        <input type="hidden" name="csrf_token" value="{{ $.CSRFToken }}">
        <input type="hidden" name="id" id="edit-id">
        <div class="field label border">
            <input type="text" name="name" id="edit-name" required>
            <label>Rule Name</label>
        </div>
        <div class="field label border">
            <select name="action" id="edit-action">
                <option value="FILTER_COMPETENCY">Filter Competency</option>
                <option value="ESCALATE">Escalate</option>
                <option value="ASSIGN_TO_SHIFT">Assign to Shift</option>
                <option value="ASSIGN_TO_RADIOLOGIST">Assign to Radiologist</option>
            </select>
            <label>Action Type</label>
        </div>
        <nav class="right-align">
            <button type="button" class="transparent link" onclick="ui('#edit-rule-modal')">Cancel</button>
            <button type="submit" class="primary">Update Rule</button>
        </nav>
    </form>
</dialog>

<script>
    function openEditModal(id, name, action) {
        document.getElementById('edit-id').value = id;
        document.getElementById('edit-name').value = name;
        document.getElementById('edit-action').value = action;
        document.getElementById('edit-rule-modal').setAttribute('open', 'true');
    }
</script>
{{ end }}
